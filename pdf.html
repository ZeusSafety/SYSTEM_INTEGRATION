<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Subida de Archivos</title>
</head>
<body>
  <h1>Subir archivo a Google Drive</h1>
  <input type="file" id="archivo">
  <button onclick="subirArchivo()">Subir</button>

  <h3>Respuesta:</h3>
  <pre id="respuesta"></pre>

<script>
async function subirArchivo() {
  const input = document.getElementById("archivo");
  const file = input.files[0];

  if (!file) {
    alert("‚ö†Ô∏è Selecciona un archivo primero");
    return;
  }

  log("üìÇ Archivo seleccionado: " + file.name + " (" + file.type + ")");

  try {
    // Convertir a base64
    const base64 = await toBase64(file);
    log("‚úÖ Archivo convertido a Base64 (longitud: " + base64.length + ")");

    // Enviar al Apps Script WebApp
    log("‚è≥ Enviando archivo al servidor...");
    const response = await fetch("https://script.google.com/macros/s/AKfycbwEhJdsh5QYLLbk9uTIGRf2KvUJwZJAfN_GqPalwJBiN4MGHn5Yh9yMWV4-sBZZjvoc/exec", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        fileName: file.name,
        mimeType: file.type || "application/octet-stream",
        fileContent: base64.split(",")[1] // quitamos encabezado
      })
    });

    log("üì° Respuesta recibida del servidor, procesando...");
    const result = await response.json();
    log("‚úÖ Respuesta del servidor:");
    log(JSON.stringify(result, null, 2));

    if (result.status === "ok") {
      alert("üéâ Archivo subido correctamente: " + result.fileName);
    } else {
      alert("‚ö†Ô∏è Error en la API: " + result.message);
    }

  } catch (err) {
    log("‚ùå Error en la subida: " + err.message);
    alert("Error en la subida: " + err.message);
  }
}

// Convierte archivo en Base64
function toBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
  });
}

// Funci√≥n para mostrar logs en pantalla
function log(msg) {
  console.log(msg);
  const out = document.getElementById("respuesta");
  out.textContent += msg + "\n";
}
</script>
</body>
</html>
